<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>mutation observer</title>
  </head>
  <body>
    <button onclick="addRow();">추가하기</button>

    <ul>
      <li>1번 아이템</li>
    </ul>

    <script>
      function addRow() {
        let list = document.querySelector("ul");
        let lastRow = document.querySelector("li:last-child");
        let newRowNum =
          parseInt(lastRow.textContent.replace(/[^0-9]/g, "")) + 1;

        let row = document.createElement("li");
        row.textContent = newRowNum + "번째 아이템";

        list.appendChild(row);

        // list.setAttribute("className", newRowNum);
      }

      // Mutation Observer
      // 감시 대상 node 선택
      let target = document.querySelector("ul");

      // 감시자 인스턴스 만들기
      let observer = new MutationObserver((mutationsList, observer) => {
        // 노드가 변경 됐을 때의 작업
        console.group("DOM 변경 감지");

        for (const mutation of mutationsList) {
          if (mutation.type === "childList") {
            console.log("타겟의 하위 요소 추가 및 제거 감지");
          } else if (mutation.type === "attributes") {
            console.log(
              mutation.attributeName + " 어트리뷰트가 변경되었습니다."
            );
          }
        }

        console.groupEnd();
      });

      // 감시자의 설정
      let config = {
        childList: true, // 타겟의 하위 요소 추가 및 제거 감지
        // attributes: true, // 타켓의 속성 변경를 감지
        // characterData: false,	// 타겟의 데이터 변경 감지
        // subtree: false,	// 타겟의 자식 노드 아래로도 모두 감지
        // attributeOldValue: false,	// 타겟의 속성 변경 전 속성 기록
        // characterDataOldValue: false	// 타겟의 데이터 변경 전 데이터 기록
      };

      // 대상 노드에 감시자 전달
      observer.observe(target, config);

      // 감시 종료
      // observer.disconnect();
    </script>
  </body>
</html>
